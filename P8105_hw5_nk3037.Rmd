---
title: "P8105_hw5_nk3037"
author: "Navya Koneripalli"
date: "2023-10-23"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(broom)
```

## Question 2
```{r}
# Create a dataframe with all the file names
file_names = list.files(path = "./data", pattern = ".csv", full.names = TRUE)

# Separate arm and subject id and combie into a single dataframe
data = file_names %>%
  map_df(~ read.csv(.x) %>%
            mutate(subject_id = str_extract(basename(.x), "\\d+"),
                   arm = str_extract(basename(.x), "con|exp")))  
# Remove unnecessary columns and convert to numeric
tidy_data = data %>%
  gather(week, observation, -subject_id, -arm) %>%
  mutate(week = as.numeric(str_extract(week, "\\d+")),
         arm = recode(arm, "con" = "control", "exp" = "experimental"))

# Making the spaghetti plot
ggplot(tidy_data, aes(x = week, y = observation, color = subject_id)) +
  geom_line() +
  facet_wrap(~arm) +
  labs(title = "Spaghetti Plot of Observations Over Time For Each Subject",
       x = "Week",
       y = "Observation")
```

The observations over time for each subject seem to be more constant for the control arm and increase between weeks 2 and 8 for the experimental arm. In general, patients in the control and experimental arm had approximately the same starting observation at week 0. Patients, 02, 06 and 10 had a sudden decrease in observation values around week 5. Similarly, patients 03, 05, 08 and 10 had a sudden decrease in observation values around week 6. In general, the experimental arm had some effect on the patients observation values, but I can't say whether it's good or bad.

## Question 3
```{r}
# Set seed for reproducibility
set.seed(1)

# Set design elements
n = 30
sigma = 5
mu = 0
alpha = 0.05
num_datasets = 5000

# One sample t-test
t_test = function(data) {
  t_test_result = t.test(data, mu = mu)
  tidy_result = broom::tidy(t_test_result)
  return(tidy_result)
}

# One sample t-test for each of the 5000 datasets
results = replicate(num_datasets, {
  data = rnorm(n, mean = mu, sd = sigma)
  t_test(data)
}, simplify = FALSE)

# Save the mean mu and p-value
mean_mu = sapply(results, function(result) result$estimate[1])
p_values = sapply(results, function(result) result$p.value)
```

